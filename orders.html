<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SmartGrocer â€” Orders</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .orders-container { max-width:1000px; margin:32px auto; padding:16px; background:rgba(255,255,255,0.03); border-radius:8px; }
    .orders-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
    .orders-header h2 { margin:0; }
    .controls button { margin-left:8px; padding:8px 12px; border-radius:6px; border:none; cursor:pointer; background:#5e17eb; color:#fff; }
    .controls button:hover { opacity:0.9; }
    table.orders { width:100%; border-collapse:collapse; margin-top:12px; }
    table.orders th, table.orders td { border:1px solid rgba(255,255,255,0.06); padding:8px; text-align:left; font-size:14px; }
    table.orders th { background: rgba(0,0,0,0.12); }
    .empty { padding:20px; text-align:center; color:#ddd; }
    .small-muted { font-size:13px; color:#ccc; }
    .delete-btn { background:red; color:white; border:none; padding:6px 10px; border-radius:4px; cursor:pointer; }
    .delete-btn:hover { opacity:0.8; }
  </style>
</head>
<body>
  <header>
    <div class="brand"><span class="logo">ðŸ›’</span><h1>SmartGrocer</h1></div>
    <nav>
      <a href="index.html">Home</a>
      <a href="orders.html">Orders</a>
    </nav>
  </header>

  <main class="orders-container">
    <div class="orders-header">
      <h2>Saved Orders</h2>
      <div class="controls">
        <button id="btn-refresh">Refresh</button>
        <button id="btn-export">Export JSON</button>
        <button id="btn-clear">Clear All</button>
      </div>
    </div>

    <div id="orders-root">
      <div class="small-muted">Loading ordersâ€¦</div>
    </div>
  </main>

  <footer>
    <p>Â© 2025 SmartGrocer | Designed by K. Sai Krishna Kumar</p>
  </footer>

  <script>
    async function loadOrders() {
      const root = document.getElementById('orders-root');
      root.innerHTML = '<div class="small-muted">Loading ordersâ€¦</div>';

      try {
        const resp = await fetch('/api/orders');
        if (!resp.ok) throw new Error('Failed to fetch orders');
        const orders = await resp.json();

        if (!orders || orders.length === 0) {
          root.innerHTML = '<div class="empty">No orders yet.</div>';
          return;
        }

        const table = document.createElement('table');
        table.className = 'orders';
        table.innerHTML = `
          <thead>
            <tr>
              <th>#</th>
              <th>Item</th>
              <th>Price</th>
              <th>Description</th>
              <th>Image</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody></tbody>
        `;
        const tbody = table.querySelector('tbody');

        orders.forEach((o, idx) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${idx + 1}</td>
            <td>${o.name}</td>
            <td>â‚¹${o.price}</td>
            <td>${o.desc}</td>
            <td><img src="${o.image}" alt="${o.name}" width="50" height="50"></td>
            <td><button class="delete-btn" data-index="${idx}">Delete</button></td>
          `;
          tbody.appendChild(tr);
        });

        root.innerHTML = '';
        root.appendChild(table);

        // Add delete button logic
        document.querySelectorAll('.delete-btn').forEach(btn => {
          btn.addEventListener('click', async e => {
            const index = e.target.getAttribute('data-index');
            if (confirm('Delete this order?')) {
              await fetch(`/api/orders/${index}, { method: 'DELETE' }`);
              loadOrders();
            }
          });
        });

      } catch (err) {
        console.error(err);
        root.innerHTML = '<div class="empty">Failed to load orders. Check console.</div>';
      }
    }

    // Clear all orders
    document.getElementById('btn-clear').addEventListener('click', async () => {
      if (confirm('âš  Are you sure you want to delete ALL orders?')) {
        await fetch('/api/orders', { method: 'DELETE' });
        loadOrders();
      }
    });

    // Export orders
    document.getElementById('btn-export').addEventListener('click', async () => {
      const resp = await fetch('/api/orders');
      const data = await resp.json();
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'orders.json';
      a.click();
      URL.revokeObjectURL(url);
    });

    document.getElementById('btn-refresh').addEventListener('click', loadOrders);
    loadOrders();
  </script>
</body>
</html>